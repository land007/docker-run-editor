for(var playProgressButton=function(a,c){console.log(a);var b=a.progress,d=instances[a.index];d._setProgress(b);1===b&&(d._stop(1),void 0!==c&&c(a))},onDownload=function(a){window.location.href=a},onDownloadLicenseRequest=function(){onDownload("/download/LicenseRequest.WibuCmRaC")},onOpenRtspUrl=function(a){var c=a.rtsp_url;console.log(c);a=a.username+":"+a.password+"@";console.log(a);c=c.replace(/rtsp:\/\//g,"rtsp://"+a);console.log(c);window.open("/show_video?rtsp="+c)},onSearchCamera=function(a){a=
a.device_info_list;vue_data.device_info_list.splice(0,vue_data.device_info_list.length);for(var c in a){var b=a[c],d=(new URL(b.xaddrs[0])).hostname;vue_data.device_info_list.push({urn:b.urn,name:b.name,ipaddress:d,hardware:b.hardware,xaddrs:b.xaddrs})}},bs="\b",i=0;12>i;i++)bs+=bs;
var timeout=null,binContextmenu=function(){$(".margin").click(function(){null!=timeout&&clearTimeout(timeout);timeout=setTimeout(function(){var a=monacoEditor.getModel(),c=monacoEditor.getSelection(),b=a.getValueInRange(c);console.log(b);null!=JASE&&(console.log(bs.length),JASE.emit("data",bs),setTimeout(function(){console.log(b.length);b.endsWith("\r")&&console.log("have r");b.endsWith("\n")&&console.log("have n");JASE.emit("data",b.replace(/\n|\r/g,"")+"\r")},500));timeout=null},1E3)})},monacoEditor;
require.config({paths:{vs:"/ajax/libs/monaco-editor/0.15.6/min/vs"},"vs/nls":{availableLanguages:{"*":"zh-cn"}}});
var editContent1='#\u8fd0\u884cC++\u6838\u5fc3\u670d\u52a1\r\nsudo docker kill eyecool-cpp-grpc_release; sudo docker rm eyecool-cpp-grpc_release; sudo docker run -it --restart=always --privileged -v ~/docker/cpp-grpc:/cpp -p 22022:20022 -p 50050:50050 -p 50051:50051 -p 50052:50052 -e "APPLICATION_SERVICE_ADDRESS=172.17.0.1" -e "APPLICATION_SERVICE_PORT=50053" -e "RTSP_URL=rtsp://admin:123456@10.28.102.195:554/video1|rtsp://admin:123456@10.28.102.197:554/video1" -e "CodeMeter_Server=172.17.0.1" -e "FACE_THREADS_NUMBER=4" -e "MATCH_THREADS_NUMBER=4" --name eyecool-cpp-grpc_release registry.eyecool.cn:5080/eyecool-cpp-grpc:v10\r\n#\u8fd0\u884cGolang\u8f85\u52a9\u670d\u52a1\uff08\u65b0\u5f00\u4e00\u4e2ashell\uff09\r\nsudo docker kill eyecool-golang-grpc_release; sudo docker rm eyecool-golang-grpc_release; sudo docker run -it --restart=always -v /:/host --link eyecool-cpp-grpc_release:eyecool-cpp-grpc_release --link eyecool-mysql:eyecool-mysql --privileged -e "AdminPass=" -e "AlgoVersion=1030" -e "OldAlgoVersion=feature" -v ~/docker/node_release:/node -v ~/docker/golang_release:/golang -v ~/docker/golang-public_release:/public -e "FaceAddress=eyecool-cpp-grpc_release:50052" -e "FaceMatchAddress=eyecool-cpp-grpc_release:50051" -e "DbHost=eyecool-mysql" -e "DbPort=3306" -e "Database=io-grpc_release" -e "DbUsername=io-grpc" -e "DbPassword=io-grpc" -e "LEVEL=release" --name eyecool-golang-grpc_release --log-opt max-size=1m --log-opt max-file=1 -p 8018:8080 -p 8900:8899 -p 22222:20022 -e "REMOTE_SNAPSHOT_SERVER=eyecool-cpp-grpc_release:50050" -e "VIDEO_SOURCE_INDEX=0" -e "LIBRARY=Test" -p 6101:6101 -p 50053:50053 -e "RTSPURLS=rtsp://admin:123456@10.28.102.195:554/video2|rtsp://admin:123456@10.28.102.197:554/video2" -e "VIDEO_SOURCE_INDEXS=0,1" -e "DOORMONITORS=http://10.20.73.118:8080/doorManager/b/monitor/openDoor?user_no={{user_no}}&device_no={{device_no}}|http://10.20.73.118:8080/doorManager/b/monitor/openDoor?user_no={{user_no}}&device_no={{device_no}}" -e "WH=1188:668" -e "QUALITY=10" -p 7101:7101 registry.eyecool.cn:5080/eyecool-golang-grpc:v9\r\n',editContent2=
"# \u5b89\u88c5C++\u6838\u5fc3\u955c\u50cf\r\ncd ~ && sudo docker load -i eyecool-cpp-grpc_v10.tar\r\n# \u5b89\u88c5Golang\u8f85\u52a9\u955c\u50cf\r\ncd ~ && sudo docker load -i eyecool-golang-grpc_v9.tar\r\n# \u5b89\u88c5Mysql\u955c\u50cf\r\ncd ~ && sudo docker load -i eyecool-mysql_5.7.22.tar\r\n# \u88c5\u8f7dMysql\u6570\u636e\r\nmkdir ~/docker ; sudo tar -zxvf eyecool-mysql_data.tar.gz -C ~/docker && ls ~/docker\r\n",editContent3="# \u68c0\u67e5\u64cd\u4f5c\u7cfb\u7edf\r\nlsb_release  -a\r\n#\tDistributor ID: Ubuntu\r\n#\tDescription:    Ubuntu 16.04.5 LTS\r\n#\tRelease:        16.04\r\n#\tCodename:       xenial\r\n\r\n# \u68c0\u67e5docker\u7248\u672c\r\nsudo docker version\r\n#\tClient:\r\n#\t Version:       18.03.0-ce\r\n#\t API version:   1.37\r\n#\t Go version:    go1.9.4\r\n#\t Git commit:    0520e24\r\n#\t Built: Wed Mar 21 23:10:01 2018\r\n#\t OS/Arch:       linux/amd64\r\n#\t Experimental:  false\r\n#\t Orchestrator:  swarm\r\n#\r\n#\tServer:\r\n#\t Engine:\r\n#\t  Version:      18.03.0-ce\r\n#\t  API version:  1.37 (minimum version 1.12)\r\n#\t  Go version:   go1.9.4\r\n#\t  Git commit:   0520e24\r\n#\t  Built:        Wed Mar 21 23:08:31 2018\r\n#\t  OS/Arch:      linux/amd64\r\n#\t  Experimental: false\r\n\r\n# \u5b89\u88c5docker\r\ncd ~/ && sudo dpkg -i docker-ce_18.06.1_ce_3-0_ubuntu_amd64.deb\r\nrm -f docker-ce_18.06.1_ce_3-0_ubuntu_amd64.deb\r\n",
editContent4="# \u5b89\u88c5codemeter\r\ncd ~/ && unzip codemeter_6.70.3152.500_amd64.deb && sudo dpkg -i codemeter_6.70.3152.500_amd64.deb\r\n# \u68c0\u6d4b\u7248\u672c\r\ncmu  --version\r\n# \u5bfc\u5165\u9884\u6388\u6743\u6587\u4ef6\r\ncd ~/ && service codemeter start && cmu --import --file EyeCool_SW-5000704_20171107.wbb\r\n# \u751f\u6210\u7533\u8bf7\u6388\u6743\u6587\u4ef6\r\ncmu --context 5000704 --file LicenseRequest.WibuCmRaC\r\n# \u5bfc\u5165\u6b63\u5f0f\u6388\u6743\r\ncmu --import --file LicenseResponse.WibuCmRaU\r\n# \u68c0\u6d4b\u6388\u6743\u72b6\u6001\r\ncmu -l\r\n# \u82e5 license \u9519\u8bef\uff0c\u5220\u9664\u5df2\u5bfc\u5165\u7684\u8bb8\u53ef\u6587\u4ef6(\u5177\u4f53\u7684Id\u53f7\u53ef\u4ee5\u901a\u8fc7cmu -l\u770b\u5230)\r\ncmu --delete-cmact-license --serial 127-125387505\r\n";
require(["vs/editor/editor.main"],function(){monacoEditor=monaco.editor.create(document.getElementById("container"),{value:editContent1,language:"shell",wordWrap:"on",wrappingIndent:"indent"});monacoEditor.onDidScrollChange(function(a){console.log("onload");binContextmenu()})});
function ReCreateEditor(a){$("#container").children().remove();require(["vs/editor/editor.main"],function(){monacoEditor=monaco.editor.create(document.getElementById("container"),{value:a,language:"shell",wordWrap:"on",wrappingIndent:"indent"})})}function GetEditorValue(){alert(monacoEditor.getValue())}
var parseString=function(a,c){Object.keys(c).forEach(function(b){"string"==typeof c[b]&&(a=a.replace(new RegExp("{{"+b+"}}","g"),c[b]))});return a},get_img_key_words=function(a,c){for(var b in a)if(a[b].image.startsWith(c))return a[b]},getP=function(a,c){if(void 0===a)return"";var b=":"+c,d;for(d in a["-p"])if(a["-p"][d].endsWith(b))return a["-p"][d].substring(0,a["-p"][d].lastIndexOf(b))},getE=function(a,c){if(void 0===a)return"";var b='"'+c+"=",d;for(d in a["-e"])if(a["-e"][d].startsWith(b))return a["-e"][d].substring(b.length,
a["-e"][d].lastIndexOf('"'))},getV=function(a,c){if(void 0===a)return"";var b=":"+c,d;for(d in a["-v"])if(a["-v"][d].endsWith(b))return a["-v"][d].substring(0,a["-v"][d].lastIndexOf(b))},getImageVersion=function(a){return void 0===a||void 0===a.image||0>=a.image.lastIndexOf(":")?"":a.image.substring(a.image.lastIndexOf(":")+1)},getRegistry=function(a){return void 0===a||void 0===a.image||0>=a.image.indexOf("/")?"":a.image.substring(0,a.image.indexOf("/"))},vue_data=new Vue({el:"#container1",data:{value:"122",
ssh_server:"192.168.0.96",level:"release",codemeter_server:"172.17.0.1",face_server_port:"50052",match_server_port:"50051",snapshot_server_port:"50050",application_service_address:"172.17.0.1",application_service_port:"50053",face_threads_number:"4",match_threads_number:"4",docker_home:"~/docker",cpp_image_version:"v10",golang_image_version:"v9",admin_pass:"",algo_version:"1030",old_algo_version:"feature",db_host:"eyecool-mysql",db_port:"3306",db_username:"io-grpc",db_password:"io-grpc",database:"io-grpc_release",
library:"Test",video_port:"6101",door_monitors:"http://10.20.73.118:8080/doorManager/b/monitor/openDoor?user_no={{user_no}}&device_no={{device_no}}",wh:"1280x720",quality:"10",registry:"registry.eyecool.cn:5080",cpp_ssh_port:"22022",golang_ssh_port:"22222",golang_port:"8018",golang_debug_port:"8900",video_websocket_port:"7101",device_info_list:[],rtsp_urls:[{value:"rtsp://aaa:1",value2:"rtsp://bbb:1"},{value:"rtsp://aaa:2",value2:"rtsp://bbb:2"},{value:"rtsp://aaa:3",value2:"rtsp://bbb:3"},{value:"rtsp://aaa:4",
value2:"rtsp://bbb:4"}],displayTxt:"\u663e\u793a\u9ad8\u7ea7\u9009\u9879",styleObject:{display:"none",padding:"10px","background-color":"slategray"},ip_segment:"192.168.0."},created:function(){},watch:{value:function(a,c){console.log(this.rtsp_urls);monacoEditor.setValue(a)},rtsp_urls:function(a,c){},level:function(a,c){console.log(a);this.database="io-grpc_"+a}},methods:{display:function(){"\u663e\u793a\u9ad8\u7ea7\u9009\u9879"==this.displayTxt?(this.displayTxt="\u9690\u85cf\u9ad8\u7ea7\u9009\u9879",
this.styleObject.display=""):(this.displayTxt="\u663e\u793a\u9ad8\u7ea7\u9009\u9879",this.styleObject.display="none")},blurTest:function(){alert(monacoEditor.getValue())},add:function(){console.log("add");this.rtsp_urls.push({value:"rtsp://",value2:"rtsp://"})},rm:function(a){this.rtsp_urls.splice(a,1)},update:function(a){console.log(a);JASE.emit("update",a)},download:function(a){console.log(a);JASE.emit("download",a)},search_camera:function(a){JASE.emit("search_camera",{ip_segment:a,index:8})},search_net:function(a){JASE.emit("search_net",
{ip_segment:a,index:8})},file_change:function(a){var c=a.target.value;a.target.value="";this.update(c)},install_docker:function(){monacoEditor.setValue(editContent3)},install_codemeter:function(){monacoEditor.setValue(editContent4)},install_image:function(){monacoEditor.setValue(editContent2)},href:function(a){null!=gui?gui.Window.open(a,{},function(a){a.maximize()}):window.open(a)},get_rtsp_url:function(a,c,b){JASE.emit("get_rtsp_url",{xaddr:a,username:c,password:b})},analysis:function(){var a=[];
this.rtsp_urls=[];var c=monacoEditor.getValue().split(/\r\n/g);for(f in c){for(var b=c[f].split(/;/g),d={"-v":[],"--link":[],"-e":[],"-p":[],"--name":[],image:""},k=0;k<b.length;k++){for(var g=b[k].split(/ /g),h=0;h<g.length;h++){var l=g[h];void 0!==d[l]&&(h++,d[l][d[l].length]=g[h])}d.image=g[g.length-1]}a[f]=d}b=get_img_key_words(a,"registry.eyecool.cn:5080/eyecool-cpp-grpc:");this.registry=getRegistry(b);this.codemeter_server=getE(b,"CodeMeter_Server");this.face_server_port=getP(b,"50052");this.match_server_port=
getP(b,"50051");this.snapshot_server_port=getP(b,"50050");this.application_service_address=getE(b,"APPLICATION_SERVICE_ADDRESS");this.application_service_port=getE(b,"APPLICATION_SERVICE_PORT");this.face_threads_number=getE(b,"FACE_THREADS_NUMBER");this.match_threads_number=getE(b,"MATCH_THREADS_NUMBER");this.cpp_ssh_port=getP(b,"20022");c=getE(b,"RTSP_URL").split("|");for(var e in c){var f=c[e];void 0===this.rtsp_urls[e]&&(this.rtsp_urls[e]={});this.rtsp_urls[e].value=f}this.cpp_image_version=getImageVersion(b);
a=get_img_key_words(a,"registry.eyecool.cn:5080/eyecool-golang-grpc:");this.registry=getRegistry(a);this.level=getE(a,"LEVEL");this.admin_pass=getE(a,"AdminPass");this.algo_version=getE(a,"AlgoVersion");this.old_algo_version=getE(a,"OldAlgoVersion");this.db_host=getE(a,"OldAlgoVersion");this.old_algo_version=getE(a,"OldAlgoVersion");this.db_host=getE(a,"DbHost");this.db_port=getE(a,"DbPort");this.db_username=getE(a,"DbUsername");this.db_password=getE(a,"DbPassword");this.database=getE(a,"Database");
this.video_port=getP(a,"6101");this.door_monitors=getE(a,"DOORMONITORS");this.wh=getE(a,"WH");this.quality=getE(a,"QUALITY");this.golang_ssh_port=getP(a,"20022");this.golang_port=getP(a,"8080");this.golang_debug_port=getP(a,"8899");this.video_websocket_port=getP(a,"7101");this.library=getE(a,"LIBRARY");c=getE(a,"RTSPURLS").split("|");for(e in c)f=c[e],void 0===this.rtsp_urls[e]&&(this.rtsp_urls[e]={}),this.rtsp_urls[e].value2=f;this.golang_image_version=getImageVersion(a)},demo:function(){monacoEditor.setValue(editContent1);
this.analysis()},generate:function(){if(""==this.level)alert("\u6ca1\u6709level\u65e0\u6cd5\u751f\u6210\uff0c\u7cfb\u7edf\u5c06\u4e3a\u4f60\u81ea\u52a8\u6062\u590d\u521d\u59cb\u8bbe\u7f6e\u3002"),this.demo();else{var a=[],c=[],b;for(b in this.rtsp_urls)a[a.length]=this.rtsp_urls[b].value,c[c.length]=this.rtsp_urls[b].value2;this.cpp_trsp_urls=a.join("|");this.golang_rtsp_urls=c.join("|");a=parseString('# \u8fd0\u884cC++\u6838\u5fc3\u670d\u52a1\r\nsudo docker kill eyecool-cpp-grpc_{{level}}; sudo docker rm eyecool-cpp-grpc_{{level}}; sudo docker run -it --restart=always --privileged -v {{docker_home}}/cpp-grpc:/cpp -p {{cpp_ssh_port}}:20022 -p {{snapshot_server_port}}:50050 -p {{match_server_port}}:50051 -p {{face_server_port}}:50052 -e "APPLICATION_SERVICE_ADDRESS={{application_service_address}}" -e "APPLICATION_SERVICE_PORT={{application_service_port}}" -e "RTSP_URL={{cpp_trsp_urls}}" -e "CodeMeter_Server={{codemeter_server}}" -e "FACE_THREADS_NUMBER={{face_threads_number}}" -e "MATCH_THREADS_NUMBER={{match_threads_number}}" --name eyecool-cpp-grpc_{{level}} {{registry}}/eyecool-cpp-grpc:{{cpp_image_version}}\r\n# \u8fd0\u884cGolang\u8f85\u52a9\u670d\u52a1\uff08\u65b0\u5f00\u4e00\u4e2ashell\uff09\r\nsudo docker kill eyecool-golang-grpc_{{level}}; sudo docker rm eyecool-golang-grpc_{{level}}; sudo docker run -it --restart=always -v /:/host --link eyecool-cpp-grpc_{{level}}:eyecool-cpp-grpc_{{level}} --link {{db_host}}:{{db_host}} --privileged -e "AdminPass={{admin_pass}}" -e "AlgoVersion={{algo_version}}" -e "OldAlgoVersion={{old_algo_version}}" -v {{docker_home}}/node_{{level}}:/node -v {{docker_home}}/golang_{{level}}:/golang -v ~/docker/golang-public_{{level}}:/public -e "FaceAddress=eyecool-cpp-grpc_{{level}}:{{face_server_port}}" -e "FaceMatchAddress=eyecool-cpp-grpc_{{level}}:{{match_server_port}}" -e "DbHost={{db_host}}" -e "DbPort={{db_port}}" -e "Database=io-grpc_{{level}}" -e "DbUsername={{db_username}}" -e "DbPassword={{db_password}}" -e "LEVEL={{level}}" --name eyecool-golang-grpc_{{level}} --log-opt max-size=1m --log-opt max-file=1 -p {{golang_port}}:8080 -p {{golang_debug_port}}:8899 -p {{golang_ssh_port}}:20022 -e "REMOTE_SNAPSHOT_SERVER=eyecool-cpp-grpc_{{level}}:{{snapshot_server_port}}" -e "LIBRARY={{library}}" -p {{video_port}}:6101 -p {{application_service_port}}:50053 -e "RTSPURLS={{golang_rtsp_urls}}" -e "DOORMONITORS={{door_monitors}}" -e "WH={{wh}}" -e "QUALITY={{quality}}" -p {{video_websocket_port}}:7101 {{registry}}/eyecool-golang-grpc:{{golang_image_version}}\r\n',
this);monacoEditor.setValue(a)}}}}),ProgressButtonCallback=function(a){var c=0,b=setInterval(function(){c=Math.min(c+.1*Math.random(),1);a._setProgress(c);1===c&&(a._stop(1),clearInterval(b))},200)},instances=[],index=0;[].slice.call(document.querySelectorAll("button.progress-button")).forEach(function(a){new function(a,b){new ProgressButton(a,{callback:function(a){instances[b]=a}})}(a,index);index++});